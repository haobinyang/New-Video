(function(e){function t(t){for(var r,s,o=t[0],c=t[1],u=t[2],h=0,d=[];h<o.length;h++)s=o[h],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&d.push(i[s][0]),i[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(d.length)d.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,o=1;o<n.length;o++){var c=n[o];0!==i[c]&&(r=!1)}r&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},i={app:0},a=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var l=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";n("85ec")},"1c2d":function(e,t,n){"use strict";n("3dba")},"1fcb":function(e,t,n){"use strict";n("36df")},"36df":function(e,t,n){},"3dba":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("Editor")],1)},a=[],s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"editor"},[n("side-menu"),n("div",{staticClass:"right"},[n("div",{staticClass:"toolbar-container"},[n("div",{staticClass:"toolbar"},[n("div",{staticClass:"left"}),n("button",{staticClass:"export-button",on:{click:e.exportClick}},[e._v(" 导出 ")])])]),n("div",{staticClass:"top"},[n("assets"),n("player")],1),n("time-line")],1)],1)},o=[],c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("div",{staticClass:"menu"},[e._l(e.menu,(function(t){return n("div",{key:t.value,class:["menu-item",t.value===e.currentTab?"active":""],on:{click:function(n){return e.itemClick(t.value)}}},[n("div",{staticClass:"left"}),n("div",{staticClass:"icon",domProps:{innerHTML:e._s(t.icon)}}),n("span",[e._v(e._s(t.label))])])})),n("a",{staticClass:"tutorial",attrs:{href:"tutorial/tutorial.mov"}},[e._v("教程")])],2)])},u=[],l=new r["a"],h='<svg width="16" height="16" fill="none" viewBox="0 0 16 16"><path d="M15 7H9V1c0-.6-.4-1-1-1S7 .4 7 1v6H1c-.6 0-1 .4-1 1s.4 1 1 1h6v6c0 .6.4 1 1 1s1-.4 1-1V9h6c.6 0 1-.4 1-1s-.4-1-1-1z" fill="currentColor"></path></svg>',d='<svg width="24" height="24" viewBox="4 2 18 20"><g stroke="currentColor" stroke-width="1.6" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"><path d="M12.813 4H7.125C6.228 4 5.5 4.716 5.5 5.6v12.8c0 .884.728 1.6 1.625 1.6h9.75c.897 0 1.625-.716 1.625-1.6V9.6L12.812 4z"></path><path d="M12.813 4v5.6H18.5"></path></g></svg>',f='<svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path fill-rule="evenodd" d="M0 2.4A2.4 2.4 0 012.4 0h10.8a2.4 2.4 0 012.4 2.4v10.8a2.4 2.4 0 01-2.4 2.4H2.4A2.4 2.4 0 010 13.2V2.4zM13.2 14H8V7.701l-5 3.572V4l5 3.571V1.6h5.2a.8.8 0 01.8.8v10.8a.8.8 0 01-.8.8zM8 7.636L13.09 4v7.273L8 7.636z" fill="currentColor"></path></svg>',m='<svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="1" width="14" height="14" rx="1.6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M7 15l7.818-7.772V15H7z" fill="currentColor"></path><path opacity="0.5" d="M1 15L15 1v14H1z" fill="currentColor"></path></svg>',v=[{label:"添加",value:"add",icon:h},{label:"媒体",value:"media",icon:d},{label:"转场",value:"transitions",icon:f},{label:"覆盖",value:"overlays",icon:m},{label:"Lottie",value:"lottie",icon:d}],p={data:function(){return{menu:v,currentTab:v[0].value}},mounted:function(){var e=this;l.$emit("changeTab",this.currentTab),l.$on("changeTab2Media",(function(){e.currentTab="media"}))},methods:{itemClick:function(e){this.currentTab=e,l.$emit("changeTab",e)}}},g=p,y=(n("c46b"),n("2877")),b=Object(y["a"])(g,c,u,!1,null,"e4cf187a",null),T=b.exports,w=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("div",{staticClass:"player"},[n("div",{ref:"videoContainer",staticClass:"video"}),n("div",{staticClass:"controls"},[n("div",{staticClass:"play-button",on:{click:e.playButtonClick}},[e.isPlaying?n("svg",{attrs:{width:"24",height:"24",viewBox:"0 0 24 24"}},[n("rect",{attrs:{x:"14",y:"4",width:"6",height:"16",rx:"1",fill:"currentColor"}}),n("rect",{attrs:{x:"4",y:"4",width:"6",height:"16",rx:"1",fill:"currentColor"}})]):n("svg",{attrs:{width:"24",height:"24",viewBox:"0 0 24 24"}},[n("path",{attrs:{d:"M20.6074 11.3193L7.37206 3.13743C7.10118 2.97052 6.75265 2.95415 6.46676 3.09652C6.17912 3.23888 6 3.51624 6 3.81815V20.1818C6 20.4837 6.17912 20.7611 6.46588 20.9035C6.59647 20.9681 6.73941 21 6.88235 21C7.05353 21 7.22471 20.9534 7.37206 20.8625L20.6074 12.6807C20.8526 12.5285 21 12.2733 21 12C21 11.7267 20.8526 11.4714 20.6074 11.3193Z",fill:"currentColor"}})])]),n("div",{staticClass:"time"},[e._v(e._s(e.time))])])]),e.exporting?n("export-dialog",{attrs:{player:e.player}}):e._e()],1)},x=[],O=(n("159b"),n("4de4"),n("1da1")),k=n("d4ec"),C=n("bee2"),E=n("ade3"),R=(n("96cf"),n("d81d"),n("7db0"),n("a434"),n("caad"),n("2532"),n("dca8"),135),j=40,I=Object.freeze({VIDEO:"Video",AUDIO:"Audio",IMAGE:"Image",TEXT:"Text",SVG:"Svg",TRANSITION:"Transition",LOTTIE:"Lottie"}),N=Object.freeze({FILL:0,CONTAIN:1,COVER:2}),A=Object.freeze({NO_EFFECT:0,BLUR:1,GRAY:2}),_=Object.freeze({MORPH:0,DREAMY:1,FADE:2}),M=Object.freeze({PLUNGING:0}),S=Object.freeze({UNKNOWN:-1,DRAGGING:0,DRAG_OVER:1,TRANSITION_UNKNOWN:2,TRANSITION_DRAGGING:3,TRANSITION_DRAG_OVER:4}),P=n("5530"),V=n("257e"),F=n("45eb"),G=n("7e84"),D=n("262e"),L=n("2caf"),U=function(){function e(t,n){Object(k["a"])(this,e),Object.assign(this,t),this.player=n,this.isAttachToPainter=!1,this.sprite=null,this.isStart=!1}return Object(C["a"])(e,[{key:"updateZIndex",value:function(e){this.zIndex=e}},{key:"onCurrentTimeChange",value:function(e){}},{key:"pause",value:function(){}},{key:"addToPainter",value:function(){this.isAttachToPainter||(this.isAttachToPainter=!0,this.player.painter.add(this.sprite,this.id))}},{key:"removeFromPainter",value:function(){this.isAttachToPainter&&(this.isAttachToPainter=!1,this.player.painter.remove(this.id))}}]),e}();n("99af");function $(e,t){switch(e){case N.FILL:return"uv";case N.CONTAIN:return".5+(uv-.5)*vec2(max(ratio/".concat(t,",1.),max(").concat(t,"/ratio,1.))");case N.COVER:return".5+(uv-.5)*vec2(min(ratio/".concat(t,",1.),min(").concat(t,"/ratio,1.))")}}var z,H=function(){function e(){Object(k["a"])(this,e)}return Object(C["a"])(e,null,[{key:"GetVertex",value:function(){var e="\n      varying vec2 texCoords;\n      void main() {\n        texCoords = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n      }\n    ";return e}},{key:"GetFragment",value:function(){var e="\n      varying vec2 texCoords;\n      uniform sampler2D tex;\n      void main() {\n        gl_FragColor = texture2D(tex, texCoords);\n      }\n    ";return e}},{key:"GetEffectFragment",value:function(e){var t=e.fitType,n=void 0===t?N.CONTAIN:t,r=e.effect,i=e.elementRatio,a=$(n,i),s="\n      varying vec2 texCoords;\n      uniform float ratio;\n      uniform sampler2D tex;\n      ".concat(r,"\n      vec4 getColor(vec2 uv) {\n        vec2 newUV = ").concat(a,";\n        vec4 color = effect(newUV);\n        if(newUV.x>1. || newUV.x<0. || newUV.y>1. || newUV.y<0.){\n          return vec4(0.,0.,0.,0.);\n        }\n        return color;\n      }\n      void main() {\n        gl_FragColor = getColor(texCoords);\n      }\n    ");return s}},{key:"GetTransitionFragment",value:function(e){var t=e.fromFitType,n=void 0===t?N.CONTAIN:t,r=e.fromEffect,i=e.fromRatio,a=e.toFitType,s=void 0===a?N.CONTAIN:a,o=e.toEffect,c=e.toRatio,u=e.transition,l=$(n,i),h=$(s,c),d="\n      varying vec2 texCoords;\n      uniform sampler2D from, to;\n      uniform float fromRatio, toRatio;\n      uniform float progress, ratio;\n      ".concat(r,"\n      ").concat(o,"\n      vec4 getFromColor(vec2 uv) {\n        vec2 newUV = ").concat(l,";\n        vec4 color = fromEffect(newUV);\n        if(newUV.x>1. || newUV.x<0. || newUV.y>1. || newUV.y<0.){\n          return vec4(0.,0.,0.,0.);\n        }\n        return color;\n      }\n      vec4 getToColor(vec2 uv) {\n        vec2 newUV = ").concat(h,";\n        vec4 color = toEffect(newUV);\n        if(newUV.x>1. || newUV.x<0. || newUV.y>1. || newUV.y<0.){\n          return vec4(0.,0.,0.,0.);\n        }\n        return color;\n      }\n      ").concat(u,"\n      void main() {\n        gl_FragColor = transition(texCoords);\n      }\n    ");return d}}]),e}();function B(){return{uniforms:{},fragment:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"tex",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"effect";return"\n      vec4 ".concat(t,"(vec2 uv) {\n        return texture2D(").concat(e,", uv);\n      }\n    ")}}}function X(){return{uniforms:{},fragment:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"tex",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"effect";return"\n      vec4 ".concat(t,"(vec2 uv) {\n        vec4 color = texture2D(").concat(e,", uv);\n        float gray = (color.r+color.g+color.b)/3.;\n        return vec4(gray,gray,gray,color.a);\n      }\n    ")}}}var Y=Object.freeze((z={},Object(E["a"])(z,A.NO_EFFECT,B),Object(E["a"])(z,A.GRAY,X),z));function W(e){return Y[e]()}var Z,q=function(e){Object(D["a"])(n,e);var t=Object(L["a"])(n);function n(e,r){var i;return Object(k["a"])(this,n),i=t.call(this,e,r),Object(E["a"])(Object(V["a"])(i),"originEffect",0),i.initRender(),i.setPlaybackRate(),i}return Object(C["a"])(n,[{key:"initRender",value:function(){var e=this.width,t=this.height,n=this.effect,r=this.texture,i=this.fitType,a=this.player,s=a.width,o=a.height,c=W(n),u=c.uniforms,l=c.fragment;this.originEffect=n,this.geometry=new THREE.PlaneGeometry(s,o),this.material=new THREE.ShaderMaterial({uniforms:Object(P["a"])({tex:{value:r},ratio:{value:s/o}},u),vertexShader:H.GetVertex(),fragmentShader:H.GetEffectFragment({elementRatio:e/t,fitType:i,effect:l()}),uniformsNeedUpdate:!0}),this.material.transparent=!0,this.sprite=new THREE.Mesh(this.geometry,this.material)}},{key:"getPlaybackRate",value:function(){var e=this.startTime,t=this.endTime,n=this.duration,r=t-e;return n/r}},{key:"setPlaybackRate",value:function(){var e=this.video,t=this.getPlaybackRate();Math.abs(e.playbackRate-t)>=1e-5&&(e.playbackRate=t)}},{key:"play",value:function(){var e=this.video;e.paused&&e.play()}},{key:"pause",value:function(){Object(F["a"])(Object(G["a"])(n.prototype),"pause",this).call(this);var e=this.video;e.paused||e.pause()}},{key:"show",value:function(){this.sprite.visible=!0}},{key:"hide",value:function(){this.sprite.visible=!1}},{key:"correctVideoCurrentTime",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(){var t,n,r,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.startTime,n=this.texture,r=this.player.currentTime,i=this.getPlaybackRate(),a=(r-t)*i/1e3,e.next=5,n.setCurrentTime(a);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"onCurrentTimeChange",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.player.isInRange(this)){e.next=13;break}if(!t){e.next=7;break}return this.pause(),e.next=5,this.correctVideoCurrentTime();case 5:e.next=8;break;case 7:this.play();case 8:this.isStart=!0,this.addToPainter(),this.render(),e.next=14;break;case 13:this.isStart&&(this.isStart=!1,this.pause(),this.removeFromPainter());case 14:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateShader",value:function(){this.originEffect,this.effect}},{key:"render",value:function(){this.updateShader(),this.sprite.position.z=this.zIndex}}]),n}(U),K=function(e){Object(D["a"])(n,e);var t=Object(L["a"])(n);function n(e,r){var i;return Object(k["a"])(this,n),i=t.call(this,e,r),Object(E["a"])(Object(V["a"])(i),"originEffect",0),i.initRender(),i}return Object(C["a"])(n,[{key:"initRender",value:function(){var e=this.width,t=this.height,n=this.effect,r=this.texture,i=this.fitType,a=this.player,s=a.width,o=a.height,c=W(n),u=c.uniforms,l=c.fragment;this.originEffect=n,this.geometry=new THREE.PlaneGeometry(s,o),this.material=new THREE.ShaderMaterial({uniforms:Object(P["a"])({tex:{value:r},ratio:{value:s/o}},u),vertexShader:H.GetVertex(),fragmentShader:H.GetEffectFragment({elementRatio:e/t,fitType:i,effect:l()}),uniformsNeedUpdate:!0}),this.material.transparent=!0,this.sprite=new THREE.Mesh(this.geometry,this.material)}},{key:"show",value:function(){this.sprite.visible=!0}},{key:"hide",value:function(){this.sprite.visible=!1}},{key:"onCurrentTimeChange",value:function(){this.player.isInRange(this)?(this.addToPainter(),this.render()):this.removeFromPainter()}},{key:"updateShader",value:function(){this.originEffect,this.effect}},{key:"render",value:function(){this.updateShader(),this.sprite.position.z=this.zIndex}}]),n}(U),J=function(e){Object(D["a"])(n,e);var t=Object(L["a"])(n);function n(e,r){return Object(k["a"])(this,n),t.call(this,e,r)}return n}(U),Q=function(e){Object(D["a"])(n,e);var t=Object(L["a"])(n);function n(e,r){return Object(k["a"])(this,n),t.call(this,e,r)}return n}(U);n("d3b7");function ee(){return{uniforms:{strength:{value:.1}},fragment:"\n      uniform float strength; // = 0.1\n      vec4 transition(vec2 p) {\n        vec4 ca = getFromColor(p);\n        vec4 cb = getToColor(p);\n        \n        vec2 oa = (((ca.rg+ca.b)*0.5)*2.0-1.0);\n        vec2 ob = (((cb.rg+cb.b)*0.5)*2.0-1.0);\n        vec2 oc = mix(oa,ob,0.5)*strength;\n        \n        float w0 = progress;\n        float w1 = 1.0-w0;\n        return mix(getFromColor(p+oc*w0), getToColor(p-oc*w1), progress);\n      }\n    "}}function te(){return{uniforms:{},fragment:"\n      vec2 offset(float progress, float x, float theta) {\n        float phase = progress*progress + progress + theta;\n        float shifty = 0.03*progress*cos(10.0*(progress+x));\n        return vec2(0, shifty);\n      }\n      vec4 transition(vec2 p) {\n        return mix(getFromColor(p + offset(progress, p.x, 0.0)), getToColor(p + offset(1.0-progress, p.x, 3.14)), progress);\n      }\n    "}}function ne(){return{uniforms:{},fragment:"\n      vec4 transition(vec2 uv) {\n        return mix(\n          getFromColor(uv),\n          getToColor(uv),\n          progress\n        );\n      }\n    "}}var re=Object.freeze((Z={},Object(E["a"])(Z,_.MORPH,ee),Object(E["a"])(Z,_.DREAMY,te),Object(E["a"])(Z,_.FADE,ne),Z));function ie(e){return re[e]()}var ae=function(e){Object(D["a"])(n,e);var t=Object(L["a"])(n);function n(e,r){var i;return Object(k["a"])(this,n),i=t.call(this,e,r),Promise.resolve().then((function(){var e=Object(V["a"])(i),t=e.player,n=e.fromId,r=e.toId;i.from=t.getElementById(n),i.to=t.getElementById(r),i.initRender()})),i}return Object(C["a"])(n,[{key:"initRender",value:function(){var e=this.fromId,t=this.toId,n=this.transition,r=this.player,i=r.width,a=r.height,s=r.getElementById(e),o=s.width,c=s.height,u=s.effect,l=s.texture,h=s.fitType,d=r.getElementById(t),f=d.width,m=d.height,v=d.effect,p=d.texture,g=d.fitType,y=W(u),b=y.uniforms,T=y.fragment,w=W(v),x=w.uniforms,O=w.fragment,k=ie(n),C=k.uniforms,E=k.fragment;this.geometry=new THREE.PlaneGeometry(i,a),this.material=new THREE.ShaderMaterial({uniforms:Object(P["a"])(Object(P["a"])(Object(P["a"])({from:{value:l},to:{value:p},progress:{value:0},ratio:{value:i/a}},b),x),C),vertexShader:H.GetVertex(),fragmentShader:H.GetTransitionFragment({fromFitType:h,fromEffect:T("from","fromEffect"),fromRatio:o/c,toFitType:g,toEffect:O("to","toEffect"),toRatio:f/m,transition:E}),uniformsNeedUpdate:!0}),this.material.transparent=!0,this.sprite=new THREE.Mesh(this.geometry,this.material)}},{key:"onCurrentTimeChange",value:function(){this.player.isInRange(this)?(this.addToPainter(),this.render()):this.removeFromPainter()}},{key:"render",value:function(){var e=this.startTime,t=this.endTime,n=this.player.currentTime,r=this.from,i=(n-e)/(t-e);this.sprite.position.z=r.zIndex+1,this.material.uniforms.progress.value=i}}]),n}(U);n("498a");function se(e){var t=e.startTime,n=e.endTime,r=e.currentTime,i=(e.easeType,e.width),a=e.height,s=(r-t)/(n-t)*100;return'\n    <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">\n      <foreignObject width="100%" height="100%">\n        <div xmlns="http://www.w3.org/1999/xhtml">\n          <div style="display: flex; align-items: stretch; width: '.concat(i,"px; height: ").concat(a,"px; clip-path: inset(").concat(s,'% 0 0 0)">\n            <div style="flex-basis: 33.33333333333333%; background: rgba(255, 255, 255, 1); clip-path: inset(0 0 0% 0)">\n              <div style="width: 100%; height: 100%; background: rgba(102, 93, 195, 1)"></div>\n            </div>\n            <div style="flex-basis: 33.33333333333333%; background: rgba(255, 255, 255, 1); clip-path: inset(0 0 0% 0)">\n              <div style="width: 100%; height: 100%; background: rgba(102, 93, 195, 1)"></div>\n            </div>\n            <div style="flex-basis: 33.33333333333333%; background: rgba(255, 255, 255, 1); clip-path: inset(0 0 0% 0)">\n              <div style="width: 100%; height: 100%; background: rgba(102, 93, 195, 1)"></div>\n            </div>\n          </div>\n        </div>\n      </foreignObject>\n    </svg>\n  ')}var oe=Object.freeze(Object(E["a"])({},M.PLUNGING,se));function ce(e){return oe[e]}function ue(e,t,n){return new Promise((function(r){var i=t.width,a=t.height,s=new Image;s.width=i,s.height=a,s.onload=function(){n.clearRect(0,0,i,a),n.drawImage(s,0,0),r()},s.src="data:image/svg+xml,".concat(e.trim())}))}var le=function(e){Object(D["a"])(n,e);var t=Object(L["a"])(n);function n(e,r){var i;return Object(k["a"])(this,n),i=t.call(this,e,r),i.initCanvas(),i.initRender(),i}return Object(C["a"])(n,[{key:"initCanvas",value:function(){var e=this.player,t=e.width,n=e.height;this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=n,this.context=this.canvas.getContext("2d")}},{key:"initRender",value:function(){var e=this.player,t=e.width,n=e.height;this.geometry=new THREE.PlaneGeometry(t,n),this.material=new THREE.MeshBasicMaterial,this.material.map=new THREE.CanvasTexture(this.canvas),this.material.transparent=!0,this.sprite=new THREE.Mesh(this.geometry,this.material)}},{key:"onCurrentTimeChange",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.player.isInRange(this)){e.next=6;break}return this.addToPainter(),e.next=4,this.render();case 4:e.next=7;break;case 6:this.removeFromPainter();case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"render",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(){var t,n,r,i,a,s,o,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.player,n=t.width,r=t.height,i=t.currentTime,a=this.func,s=this.startTime,o=this.endTime,c=a({startTime:s,endTime:o,currentTime:i,width:n,height:r}),e.next=4,ue(c,this.canvas,this.context);case 4:this.material.map.needsUpdate=!0,this.sprite.position.z=this.zIndex;case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),n}(U),he=(n("b0c0"),function(){function e(t,n){Object(k["a"])(this,e),this.scene=new THREE.Scene,this.camera=new THREE.OrthographicCamera(t/-2,t/2,n/2,n/-2,-1e3,1e3),this.renderer=new THREE.WebGLRenderer({preserveDrawingBuffer:!0,antialias:!0}),this.renderer.setPixelRatio(2),this.renderer.setSize(t,n),this.maxAnisotropy=this.renderer.capabilities.getMaxAnisotropy()}return Object(C["a"])(e,[{key:"add",value:function(e,t){e.name=t,this.scene.add(e)}},{key:"remove",value:function(e){var t=this.scene.getObjectByName(e);this.scene.remove(t)}},{key:"getDomElement",value:function(){return this.renderer.domElement}},{key:"render",value:function(){var e=this.renderer,t=this.scene,n=this.camera;e.render(t,n)}}]),e}()),de=function(e){Object(D["a"])(n,e);var t=Object(L["a"])(n);function n(e,r){var i;return Object(k["a"])(this,n),i=t.call(this,e,r),i.initRender(),i}return Object(C["a"])(n,[{key:"initRender",value:function(){var e=this.player,t=e.width,n=e.height;this.geometry=new THREE.PlaneGeometry(t,n),this.material=new THREE.MeshBasicMaterial;var r=new THREE.CanvasTexture;r.animation=this.lottie,r.image=this.lottie.container,this.material.map=r,this.material.transparent=!0,this.sprite=new THREE.Mesh(this.geometry,this.material)}},{key:"onCurrentTimeChange",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.player.isInRange(this)?(this.addToPainter(),this.render()):this.removeFromPainter();case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"render",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=this.player.currentTime,n=this.startTime,this.lottie.goToAndStop(t-n),this.material.map.needsUpdate=!0,this.sprite.position.z=this.zIndex;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),n}(U);function fe(e,t){switch(e.type){case I.VIDEO:return new q(e,t);case I.IMAGE:return new K(e,t);case I.TRANSITION:return new ae(e,t);case I.TEXT:return new J(e,t);case I.AUDIO:return new Q(e,t);case I.SVG:return new le(e,t);case I.LOTTIE:return new de(e,t)}}var me=function(){function e(t){var n=this,r=t.elements,i=t.width,a=t.height,s=t.onCurrentTimeChange,o=t.onEnd;Object(k["a"])(this,e),Object(E["a"])(this,"currentTime",0),Object(E["a"])(this,"duration",0),Object(E["a"])(this,"elements",[]),Object(E["a"])(this,"playing",!1),Object(E["a"])(this,"width",0),Object(E["a"])(this,"height",0),Object(E["a"])(this,"tickTime",-1),Object(E["a"])(this,"tickReq",0),Object(E["a"])(this,"tickFun",void 0),Object(E["a"])(this,"onCurrentTimeChange",void 0),Object(E["a"])(this,"onEnd",void 0),this.width=i,this.height=a,this.painter=new he(i,a),this.tickFun=this.tick.bind(this),this.elements=(r||[]).map((function(e){return fe(e,n)})),this.updateDuration(),this.onCurrentTimeChange=s,this.onEnd=o}return Object(C["a"])(e,[{key:"updateDuration",value:function(){var e=this;this.duration=0,this.elements.forEach((function(t){var n=t.endTime;n>e.duration&&(e.duration=n)}))}},{key:"isInRange",value:function(e){var t=e.startTime,n=e.endTime;return t<=this.currentTime&&n>=this.currentTime}},{key:"getElementById",value:function(e){return this.elements.find((function(t){return t.id===e}))}},{key:"addElement",value:function(e){this.elements.push(fe(e,this)),this.updateDuration(),this.pause()}},{key:"removeElement",value:function(e){var t=this.getElementById(e);if(t.removeFromPainter(),this.elements.splice(this.elements.indexOf(t),1),[I.VIDEO,I.IMAGE].includes(t.type))for(var n=0;n<this.elements.length;n++)this.elements[n].type===I.TRANSITION&&[this.elements[n].fromId,this.elements[n].toId].includes(t.id)&&this.elements.splice(n,1);this.updateDuration(),this.pause()}},{key:"updateZIndex",value:function(e,t){var n=this.getElementById(e);n.updateZIndex(t)}},{key:"updateTimes",value:function(e,t,n){var r=this.getElementById(e);r.startTime=t,r.endTime=n}},{key:"play",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.playing||(this.playing=!0,this.tickReq=requestAnimationFrame(this.tickFun)),e.next=3,this.renderFrame(!1);case 3:this.tickTime=performance.now();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"tick",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=Math.ceil(t-this.tickTime),!(this.currentTime+n>=this.duration)){e.next=9;break}return this.currentTime=this.duration,e.next=5,this.renderFrame(!1);case 5:this.pause(),null===(r=this.onEnd)||void 0===r||r.call(this),e.next=14;break;case 9:return this.currentTime+=n,e.next=12,this.renderFrame(!1);case 12:this.tickTime=t,this.tickReq=requestAnimationFrame(this.tickFun);case 14:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"pause",value:function(){this.tickTime=-1,this.playing=!1,cancelAnimationFrame(this.tickReq),this.elements.forEach((function(e){e.pause()}))}},{key:"setCurrentTime",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.pause(),this.currentTime=t,e.next=4,this.renderFrame(!0);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"renderFrame",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=this.elements,r.sort((function(e,t){return t.zIndex-e.zIndex})),i=this.elements.length,a=0;case 4:if(!(a<i)){e.next=10;break}return e.next=7,r[a].onCurrentTimeChange(t);case 7:a++,e.next=4;break;case 10:this.painter.render(),null===(n=this.onCurrentTimeChange)||void 0===n||n.call(this,this.currentTime);case 12:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"destroy",value:function(){this.elements.length=0,this.elements=[]}},{key:"attachTo",value:function(e){e.appendChild(this.painter.getDomElement())}}]),e}(),ve=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("div",{ref:"videoContainer",staticClass:"player"}),e._m(0),e._m(1)])},pe=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{position:"absolute",left:"0",top:"0","z-index":"99"}},[n("canvas",{staticStyle:{width:"640px",height:"360px"},attrs:{id:"canvas",width:"640",height:"360"}})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tip"},[e._v("视频导出中..."),n("br"),e._v("根据视频的长度，导出时间可能需要几分钟或更长")])}];n("ac1f"),n("466d"),n("841c"),n("3ca3"),n("ddb0"),n("2b3d");function ge(e,t){return new Promise((function(n){var r=new Worker("./workers/media_info.js");r.postMessage({file:e,arrayBuffer:t}),r.onmessage=function(t){n(Object(P["a"])(Object(P["a"])({},t.data),{},{size:e.size}))}}))}function ye(e,t){return new Promise((function(n){var r=new Worker("./workers/extract_video.js");r.postMessage({file:e,arrayBuffer:t}),r.onmessage=function(e){n(e.data)}}))}function be(e){return new Promise((function(t){window.setTimeout(t,e)}))}function Te(e){return we.apply(this,arguments)}function we(){return we=Object(O["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.toBlob(function(){var t=Object(O["a"])(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.arrayBuffer();case 2:r=t.sent,e(r);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),"image/jpeg",1)})));case 1:case"end":return e.stop()}}),e)}))),we.apply(this,arguments)}function xe(e){return Oe.apply(this,arguments)}function Oe(){return Oe=Object(O["a"])(regeneratorRuntime.mark((function e(t){var n,r,i,a,s,o,c,u=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=u.length>1&&void 0!==u[1]?u[1]:"export.mp4",r=u.length>2&&void 0!==u[2]?u[2]:30,i=1e3/r,a=[],s=0;case 5:if(!(s<t.duration)){e.next=17;break}return e.next=8,t.setCurrentTime(s);case 8:return e.next=10,Te(t.painter.getDomElement());case 10:return o=e.sent,a.push(o),e.next=14,be(i);case 14:s+=i,e.next=5;break;case 17:return t.setCurrentTime(t.duration),e.next=20,Te(t.painter.getDomElement());case 20:return c=e.sent,a.push(c),e.abrupt("return",new Promise((function(e){var t=new Worker("./workers/export_video.js");t.postMessage({frames:a,fileName:n,fps:r}),t.onmessage=function(t){a.length=0,a=[],ke(URL.createObjectURL(t.data),n),e(!0)}})));case 23:case"end":return e.stop()}}),e)}))),Oe.apply(this,arguments)}function ke(e,t){if(window.ActiveXObject){if(window.ActiveXObject&&document.execCommand){var n=window.open(e,"_blank");n.document.close(),n.document.execCommand("SaveAs",!0,t||e),n.close()}}else{var r=document.createElement("a");if(r.href=e,r.target="_blank",r.download=t,navigator.userAgent.toLowerCase().match(/(ipad|iphone|safari)/)&&navigator.userAgent.search("Chrome")<0)document.location=r.href;else{var i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});r.dispatchEvent(i),(window.URL||window.webkitURL).revokeObjectURL(r.href)}}}var Ce={props:["player"],mounted:function(){var e=this;return Object(O["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={width:Math.ceil(640),height:Math.ceil(360),elements:e.player.elements},r=new me(n),r.setCurrentTime(0),r.attachTo(e.$refs["videoContainer"]),t.next=6,xe(r);case 6:l.$emit("exportClose");case 7:case"end":return t.stop()}}),t)})))()},methods:{close:function(){l.$emit("exportClose")}}},Ee=Ce,Re=(n("1c2d"),Object(y["a"])(Ee,ve,pe,!1,null,"07369f96",null)),je=Re.exports;n("25f0"),n("0481"),n("4d90");function Ie(e){return Ne.apply(this,arguments)}function Ne(){return Ne=Object(O["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",new Promise((function(e){var n=document.createElement("video");n.src=URL.createObjectURL(new Blob([t],{type:"video/mp4"})),n.loop=!1,n.addEventListener("loadeddata",Object(O["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=new THREE.VideoTexture(n),t.next=3,r.setCurrentTime(0);case 3:e({video:n,texture:r});case 4:case"end":return t.stop()}}),t)}))))})));case 4:e.prev=4,e.t0=e["catch"](0),console.error(e.t0);case 7:case"end":return e.stop()}}),e,null,[[0,4]])}))),Ne.apply(this,arguments)}function Ae(e){return new Promise((function(t){(new THREE.TextureLoader).load(URL.createObjectURL(e),(function(e){t({image:e.image,texture:e})}))}))}function _e(e){return Me.apply(this,arguments)}function Me(){return Me=Object(O["a"])(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,i=document.createElement("div"),i.style.width="640px",i.style.height="360px",document.body.appendChild(i),e.abrupt("return",lottie.loadAnimation({container:i,renderer:"canvas",autoplay:!1,animationData:r}));case 11:case"end":return e.stop()}}),e)}))),Me.apply(this,arguments)}function Se(){return Math.random().toString(36).substr(2,9)}function Pe(e){return Ve.apply(this,arguments)}function Ve(){return Ve=Object(O["a"])(regeneratorRuntime.mark((function e(t){var n,r,i,a,s,o,c,u,l,h;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=t.type,r=t.value,i=t.name,a=t.duration,e.t0=n,e.next=e.t0===I.VIDEO?4:e.t0===I.IMAGE?10:e.t0===I.TRANSITION?16:e.t0===I.SVG?17:e.t0===I.LOTTIE?18:19;break;case 4:return e.next=6,Ie(r);case 6:return s=e.sent,o=s.video,c=s.texture,e.abrupt("return",{type:n,texture:c,video:o,name:i,duration:1e3*o.duration,effect:A.NO_EFFECT,width:o.videoWidth,height:o.videoHeight,fitType:N.COVER});case 10:return e.next=12,Ae(r);case 12:return u=e.sent,l=u.image,h=u.texture,e.abrupt("return",{type:n,texture:h,width:l.naturalWidth,height:l.naturalHeight,effect:A.NO_EFFECT,fitType:N.COVER,name:i,duration:2e3});case 16:return e.abrupt("return",{type:n,transition:r,name:i,duration:a});case 17:return e.abrupt("return",{type:n,func:ce(r),name:i,duration:a});case 18:return e.abrupt("return",{type:n,name:i,lottie:r,duration:a});case 19:case"end":return e.stop()}}),e)}))),Ve.apply(this,arguments)}function Fe(e,t,n){var r=e.duration/2;return{type:I.TRANSITION,transition:e.value,id:Se(),fromId:t.id,toId:n.id,startTime:t.endTime-r,endTime:t.endTime+r,duration:e.duration,name:e.name}}function Ge(e,t,n){return De.apply(this,arguments)}function De(){return De=Object(O["a"])(regeneratorRuntime.mark((function e(t,n,r){var i,a,s,o,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Pe(t);case 2:return i=e.sent,a=i.duration,s=a/1e3*j,o=s*(n.x/R),c=Math.max(0,(r.x-o)/j*1e3),e.abrupt("return",Object(P["a"])({id:Se(),startTime:c,endTime:c+a},i));case 8:case"end":return e.stop()}}),e)}))),De.apply(this,arguments)}function Le(e){return e/j*1e3}function Ue(e,t){var n=Le(t);if(n<=e[0].startTime)return 0;for(var r=1;r<e.length-1;r++)if(n>e[r].endTime&&n<e[r+1].startTime)return r+1;return n>=e[e.length-1].endTime?e.length:void 0}function $e(e,t){var n=e.startTime,r=e.endTime,i=t.startTime,a=t.endTime;return n>i?r-i<r-n+a-i:a-n<r-n+a-i}function ze(e){for(var t=e.length,n=0;n<t-1;n++){var r=e[n],i=e[n+1];$e(r,i)&&(i.startTime=r.endTime,i.endTime=i.startTime+i.duration)}}function He(e){return e.filter((function(e){return e.length>0})).flat()}function Be(e){var t=He(e),n=0;return t.forEach((function(e){var t=e.endTime;t>n&&(n=t)})),n}function Xe(e){var t=Math.round(e),n=t%1e3,r=Math.floor(t/1e3),i=r%60,a=Math.floor(r/60),s=a%60,o=Math.floor(a/60);return"".concat(o.toString().padStart(2,"0"),":").concat(s.toString().padStart(2,"0"),":").concat(i.toString().padStart(2,"0"),".").concat(n.toString().padStart(3,"0"))}var Ye={components:{ExportDialog:je},data:function(){return{player:null,isPlaying:!1,exporting:!1,currentTime:0}},computed:{time:function(){return Xe(this.currentTime)}},mounted:function(){var e=this,t={width:640,height:360,elements:[],onCurrentTimeChange:function(t){e.currentTime=t,l.$emit("setCurrentTimeToTimeLine",t)},onEnd:function(){e.isPlaying=!1}};this.player=new me(t),this.player.setCurrentTime(0),this.player.attachTo(this.$refs["videoContainer"]),l.$on("addElement",(function(t,n){e.add(n),e.update(t),e.player.renderFrame(!0)})),l.$on("removeElement",(function(t){e.remove(t),e.player.renderFrame(!0)})),l.$on("setCurrentTimeToPlayer",(function(t){e.currentTime=t,e.player.setCurrentTime(t)})),l.$on("exportVideo",(function(){e.exporting=!0})),l.$on("exportClose",(function(){e.exporting=!1}))},methods:{add:function(e){this.player.addElement(e)},remove:function(e){this.player.removeElement(e)},update:function(e){var t=this;e.filter((function(e){return e.length>0})).forEach((function(e,n){e.forEach((function(e){var r=e.id,i=e.startTime,a=e.endTime;t.player.updateZIndex(r,n),t.player.updateTimes(r,i,a)}))}))},playButtonClick:function(){this.isPlaying?(this.isPlaying=!1,this.player.pause()):(this.isPlaying=!0,this.player.play())}}},We=Ye,Ze=(n("1fcb"),Object(y["a"])(We,w,x,!1,null,"e317af16",null)),qe=Ze.exports,Ke=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("div",{staticClass:"inner-container"},[n("div",{staticClass:"scroll-area",style:{width:e.scrollWidth+"px"},on:{"!click":function(t){return e.timeLineClick(t)}}},[n("anchor",{attrs:{currentTime:e.currentTime}}),n("div",{staticClass:"time-rule"},e._l(Array(e.duration),(function(t,r){return n("div",{key:r,staticClass:"one-second"},[e._v(e._s(r))])})),0),n("div",{staticClass:"drop-zone-list"},e._l(e.list,(function(t,r){return n("div",{key:t?t.id:r,class:e.getClasses(r),on:{mouseover:e.dropZoneMouseOver}},[e._l(t,(function(r,i){return[n("div",{key:r.id,class:e.getElementClasses(r),style:e.getElementStyle(r),on:{click:function(t){return e.elementClick(r.id)}}},[e._v(" "+e._s(r.name)+" ")]),e.isAdjacent(t,i)?n("div",{key:"transition_"+r.id,class:e.getTransitionClasses("transition_"+r.id),style:e.getTransitionStyle(r),attrs:{"data-id":"transition_"+r.id}}):e._e()]}))],2)})),0)],1)])])},Je=[],Qe=(n("a630"),n("5319"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"anchor",style:{left:e.left}},[n("svg",{attrs:{width:"12",height:"14",viewBox:"0 0 12 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[n("path",{attrs:{d:"M0 1.16667V7.67376C0 7.98888 0.127471 8.2906 0.353409 8.51026L5.18674 13.2093C5.63955 13.6496 6.36045 13.6496 6.81326 13.2093L11.6466 8.51026C11.8725 8.2906 12 7.98888 12 7.67376V1.16667C12 0.522335 11.4777 0 10.8333 0H1.16667C0.522335 0 0 0.522334 0 1.16667Z",fill:"white"}})])])}),et=[],tt={props:["currentTime"],computed:{left:function(){return"".concat(this.currentTime/1e3*j+18,"px")}}},nt=tt,rt=(n("b0ed"),Object(y["a"])(nt,Qe,et,!1,null,"29de2020",null)),it=rt.exports,at={components:{Anchor:it},data:function(){return{list:[[]],overIndex:-1,status:S.UNKNOWN,transitionId:"",offsetX:0,offsetY:0,currentTime:0,activeId:null}},computed:{duration:function(){return 60},scrollWidth:function(){return this.duration*j+36}},methods:{getClasses:function(e){var t=this.status,n=this.overIndex,r=this.list,i=["drop-zone"];return t!==S.DRAGGING||r[e].length?t===S.DRAG_OVER&&(n===e?i.push("hover"):r[e].length||i.push("prepare")):i.push("prepare"),i},getTransitionClasses:function(e){var t=this.status,n=["transition-drop-zone"];return t===S.TRANSITION_DRAGGING?n.push("prepare"):t===S.TRANSITION_DRAG_OVER&&e===this.transitionId&&n.push("hover"),n},getTransitionStyle:function(e){return{left:e.endTime/1e3*j+"px"}},findOverElementIndex:function(e){var t=Array.from(document.querySelectorAll(".drop-zone"));return t.indexOf(e)},add:function(e,t){var n=this;return Object(O["a"])(regeneratorRuntime.mark((function r(){var i,a,s,o,c,u,h;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return i=n.overIndex,a=n.list,s=n.offsetX,o=n.offsetY,r.next=3,Ge(e,t,{x:s,y:o});case 3:c=r.sent,u=a[i],u.length?(h=Ue(u,s),u.splice(h,0,c),ze(u)):a.splice(i,1,[],[c],[]),n.activeId=c.id,l.$emit("addElement",a,c);case 8:case"end":return r.stop()}}),r)})))()},addTransition:function(e){for(var t,n,r=this.list,i=this.transitionId,a=i.replace("transition_",""),s=0;s<r.length;s++)for(var o=r[s],c=0;c<o.length;c++)if(o[c].id===a){t=o[c],n=o[c+1];var u=Fe(e,t,n);return o.splice(c+1,0,u),l.$emit("addElement",r,u),void(this.activeId=u.id)}},remove:function(){for(var e=this.list,t=0;t<e.length;t++)for(var n=e[t],r=0;r<n.length;r++){var i,a,s=n[r];if(s.id===this.activeId)(null===(i=n[r+1])||void 0===i?void 0:i.type)===I.TRANSITION?n.splice(r,2):(null===(a=n[r-1])||void 0===a?void 0:a.type)===I.TRANSITION?n.splice(r-1,2):n.splice(r,1),n.length||1===e.length||e.splice(t,2)}},dropZoneMouseOver:function(e){var t=e.offsetX,n=e.offsetY;this.offsetX=t,this.offsetY=n},getElementClasses:function(e){var t=this.activeId,n=["element"];return t===e.id&&n.push("active"),e.type===I.TRANSITION&&n.push("transition"),n},getElementStyle:function(e){var t=e.startTime,n=e.endTime;return{left:"".concat(t/1e3*j,"px"),width:"".concat((n-t)/1e3*j,"px")}},timeLineClick:function(e){var t=e.currentTarget.getBoundingClientRect(),n=e.clientX-t.left,r=(n-18)/j*1e3,i=Be(this.list);this.currentTime=Math.min(Math.max(0,r),i),l.$emit("setCurrentTimeToPlayer",this.currentTime)},elementClick:function(e){this.activeId=e},isAdjacent:function(e,t){var n=e[t],r=e[t+1];return!!(n&&r&&[I.VIDEO,I.IMAGE].includes(n.type)&&[I.VIDEO,I.IMAGE].includes(r.type)&&Math.abs(n.endTime-r.startTime)<=1e-5)}},mounted:function(){var e=this;l.$on("dragging",(function(){e.status=S.DRAGGING,e.overIndex=-1})),l.$on("dragOver",(function(t){e.status=S.DRAG_OVER,e.overIndex=e.findOverElementIndex(t)})),l.$on("dragCancelled",(function(){e.status=S.UNKNOWN,e.overIndex=-1})),l.$on("dragged",(function(t){var n=t.data,r=t.position;window.setTimeout((function(){e.add(n,r),e.status=S.UNKNOWN,e.overIndex=-1}),100)})),l.$on("transitionDragging",(function(){e.status=S.TRANSITION_DRAGGING})),l.$on("transitionDragOver",(function(t){e.status=S.TRANSITION_DRAG_OVER,e.transitionId=t.getAttribute("data-id")})),l.$on("transitionDragCancelled",(function(){e.status=S.UNKNOWN})),l.$on("transitionDragged",(function(t){var n=t.data;t.position;window.setTimeout((function(){e.addTransition(n),e.status=S.UNKNOWN}),100)})),l.$on("setCurrentTimeToTimeLine",(function(t){e.currentTime=t})),document.addEventListener("keyup",(function(t){"Backspace"===t.key&&e.activeId&&(l.$emit("removeElement",e.activeId),e.remove())}))}},st=at,ot=(n("bf6f"),n("cbb2"),Object(y["a"])(st,Ke,Je,!1,null,"6b5612c0",null)),ct=ot.exports,ut=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},["add"===e.currentTab?[n("file-upload",{attrs:{accept:"video/*, image/png, image/jpeg, image/jpg"},on:{"input-file":e.inputFile}},[e.isTranscode?n("div",{staticClass:"transcode-tip"},[e._v(" 转码中，请稍候... ")]):e._e()])]:e._l(e.assets[e.currentTab],(function(t){return n("div",{key:t.name,staticClass:"card"},[n("div",{staticClass:"frame"},[n("div",{staticClass:"element",on:{mousedown:function(n){return e.mouseDown(n,t)},mouseup:function(n){return e.mouseUp(n,t)}}},[e._v(" "+e._s(t.name)+" ")])]),n("div",{staticClass:"title"},[e._v(e._s(t.name))])])}))],2)},lt=[],ht=n("8019"),dt=n.n(ht),ft={components:{FileUpload:dt.a},data:function(){return{element:null,shiftX:0,shiftY:0,selectedAsset:null,isTranscode:!1,assets:{media:[],transitions:[{name:"Morph",value:_.MORPH,type:I.TRANSITION,duration:2e3},{name:"Dreamy",value:_.DREAMY,type:I.TRANSITION,duration:2e3},{name:"Fade",value:_.FADE,type:I.TRANSITION,duration:2e3}],overlays:[{name:"Plunging",value:M.PLUNGING,type:I.SVG,duration:2e3}],lottie:[{name:"markus",value:"./lotties/markus.json",type:I.LOTTIE},{name:"word",value:"./lotties/word.json",type:I.LOTTIE},{name:"lottieLogo",value:"./lotties/lottie-logo.json",type:I.LOTTIE}]},currentTab:"add"}},mounted:function(){var e=this;l.$on("changeTab",(function(t){e.currentTab=t}))},methods:{inputFile:function(e){var t=this;return Object(O["a"])(regeneratorRuntime.mark((function n(){var r,i,a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!e){n.next=21;break}if(r=e.type.indexOf("image")>-1?I.IMAGE:I.VIDEO,r!==I.VIDEO){n.next=17;break}return n.next=5,e.file.arrayBuffer();case 5:return i=n.sent,n.next=8,ge(e,i);case 8:if(s=n.sent,"h264"===(null===s||void 0===s||null===(a=s.video)||void 0===a?void 0:a.compression)){n.next=15;break}return t.isTranscode=!0,n.next=13,ye(e,i);case 13:i=n.sent,t.isTranscode=!1;case 15:n.next=18;break;case 17:i=e.file;case 18:t.assets.media.push({name:e.name,value:i,type:r}),t.currentTab="media",l.$emit("changeTab2Media","media");case 21:case"end":return n.stop()}}),n)})))()},mouseDown:function(e,t){var n=e.target,r=e.pageX,i=e.pageY,a=e.clientX,s=e.clientY;this.element=n,this.shiftX=a-this.element.getBoundingClientRect().left,this.shiftY=s-this.element.getBoundingClientRect().top,this.element.style.position="absolute",this.element.style.zIndex=1e3,this.moveAt(r,i),this.selectedAsset=t,document.addEventListener("mousemove",this.mouseMove)},moveAt:function(e,t){var n=this.element,r=this.shiftX,i=this.shiftY;n.style.left=e-r+"px",n.style.top=t-i+"px"},mouseMove:function(e){var t=e.pageX,n=e.pageY,r=e.clientX,i=e.clientY;this.moveAt(t,n),this.element.hidden=!0;var a=document.elementFromPoint(r,i);this.element.hidden=!1,a&&(this.selectedAsset.type===I.TRANSITION?a.closest(".transition-drop-zone")?l.$emit("transitionDragOver",a):l.$emit("transitionDragging",a):a.closest(".drop-zone")?l.$emit("dragOver",a):l.$emit("dragging",a))},mouseUp:function(e,t){var n=this;return Object(O["a"])(regeneratorRuntime.mark((function r(){var i,a,s,o,c,u,h,d;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(i=n.element,a=n.mouseMove,s=e.clientX,o=e.clientY,c=e.offsetX,u=e.offsetY,n.element.hidden=!0,h=document.elementFromPoint(s,o),n.element.hidden=!1,n.selectedAsset.type!==I.TRANSITION){r.next=9;break}h&&h.closest(".transition-drop-zone")?l.$emit("transitionDragged",{data:t,position:{x:c,y:u}}):l.$emit("transitionDragCancelled"),r.next=20;break;case 9:if(!h||!h.closest(".drop-zone")){r.next=19;break}if(n.selectedAsset.type!==I.LOTTIE){r.next=16;break}return r.next=13,_e(t.value);case 13:d=r.sent,t.value=d,t.duration=d.totalFrames/d.frameRate*1e3;case 16:l.$emit("dragged",{data:t,position:{x:c,y:u}}),r.next=20;break;case 19:l.$emit("dragCancelled");case 20:i.style.position="",document.removeEventListener("mousemove",a);case 22:case"end":return r.stop()}}),r)})))()}}},mt=ft,vt=(n("61b5"),n("d278"),Object(y["a"])(mt,ut,lt,!1,null,"0ff255bb",null)),pt=vt.exports,gt={components:{SideMenu:T,Player:qe,TimeLine:ct,Assets:pt},methods:{exportClick:function(){l.$emit("exportVideo")}}},yt=gt,bt=(n("9bc2"),n("f2b4"),Object(y["a"])(yt,s,o,!1,null,"e342dd48",null)),Tt=bt.exports,wt={name:"App",components:{Editor:Tt}},xt=wt,Ot=(n("034f"),Object(y["a"])(xt,i,a,!1,null,null,null)),kt=Ot.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(e){return e(kt)}}).$mount("#app")},"5fec":function(e,t,n){},"613b":function(e,t,n){},"61b5":function(e,t,n){"use strict";n("8ca2")},"6d97":function(e,t,n){},"85ec":function(e,t,n){},"8ca2":function(e,t,n){},"9bc2":function(e,t,n){"use strict";n("f4a5")},b0ed:function(e,t,n){"use strict";n("b1f4")},b1f4:function(e,t,n){},bf6f:function(e,t,n){"use strict";n("6d97")},c46b:function(e,t,n){"use strict";n("613b")},cbb2:function(e,t,n){"use strict";n("f3ba")},d257:function(e,t,n){},d278:function(e,t,n){"use strict";n("d257")},f2b4:function(e,t,n){"use strict";n("5fec")},f3ba:function(e,t,n){},f4a5:function(e,t,n){}});
//# sourceMappingURL=app.931c5dbb.js.map